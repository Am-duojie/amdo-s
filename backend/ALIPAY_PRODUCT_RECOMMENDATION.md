# æ”¯ä»˜å®äº§å“æ¨è - åŸºäºé¡¹ç›®åŠŸèƒ½åˆ†æ

## é¡¹ç›®åŠŸèƒ½åˆ†æ

æ ¹æ®æ‚¨çš„é¡¹ç›®ä»£ç å’Œä¸šåŠ¡æµç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ª**äºŒæ‰‹äº¤æ˜“å¹³å°**ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

### 1. æ˜“æ·˜è®¢å•ï¼ˆOrderï¼‰
- **åœºæ™¯**ï¼šç”¨æˆ·ä¹‹é—´çš„äºŒæ‰‹å•†å“äº¤æ˜“
- **æ”¯ä»˜æ–¹å‘**ï¼šä¹°å®¶ â†’ å–å®¶ï¼ˆé€šè¿‡å¹³å°ï¼‰
- **ä½¿ç”¨è®¾å¤‡**ï¼šPC ç«¯å’Œç§»åŠ¨ç«¯

### 2. å®˜æ–¹éªŒè®¢å•ï¼ˆVerifiedOrderï¼‰
- **åœºæ™¯**ï¼šç”¨æˆ·è´­ä¹°å¹³å°å®˜æ–¹éªŒè´§çš„å•†å“
- **æ”¯ä»˜æ–¹å‘**ï¼šä¹°å®¶ â†’ å¹³å°
- **ä½¿ç”¨è®¾å¤‡**ï¼šPC ç«¯å’Œç§»åŠ¨ç«¯

### 3. å›æ”¶è®¢å•ï¼ˆRecycleOrderï¼‰
- **åœºæ™¯**ï¼šç”¨æˆ·å›æ”¶è®¾å¤‡ç»™å¹³å°
- **æ”¯ä»˜æ–¹å‘**ï¼šå¹³å° â†’ ç”¨æˆ·ï¼ˆæ‰“æ¬¾ï¼‰
- **ç‰¹ç‚¹**ï¼šå¹³å°ç»™ç”¨æˆ·è½¬è´¦

---

## æ¨èä½¿ç”¨çš„æ”¯ä»˜å®äº§å“

### âœ… 1. ç”µè„‘ç½‘ç«™æ”¯ä»˜ï¼ˆå·²å®ç°ï¼Œæ¨èç»§ç»­ä½¿ç”¨ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ˜“æ·˜è®¢å•æ”¯ä»˜ï¼ˆPC ç«¯ï¼‰
- âœ… å®˜æ–¹éªŒè®¢å•æ”¯ä»˜ï¼ˆPC ç«¯ï¼‰

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²å®ç°

**ä¼˜åŠ¿**ï¼š
- é€‚åˆ PC ç«¯ç”¨æˆ·
- ç”¨æˆ·ä½“éªŒå¥½ï¼Œè·³è½¬åˆ°æ”¯ä»˜å®æ”¶é“¶å°å®Œæˆæ”¯ä»˜
- æ”¯æŒå¼‚æ­¥é€šçŸ¥ï¼Œæ”¯ä»˜ç»“æœå¯é 

**æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­â­ï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰

---

### âœ… 2. æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼ˆå¼ºçƒˆæ¨èæ–°å¢ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ˜“æ·˜è®¢å•æ”¯ä»˜ï¼ˆç§»åŠ¨ç«¯ï¼‰
- âœ… å®˜æ–¹éªŒè®¢å•æ”¯ä»˜ï¼ˆç§»åŠ¨ç«¯ï¼‰

**å½“å‰çŠ¶æ€**ï¼šâŒ æœªå®ç°

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼š
- ç§»åŠ¨ç«¯ç”¨æˆ·å æ¯”é«˜
- æ‰‹æœºç½‘ç«™æ”¯ä»˜åœ¨ç§»åŠ¨ç«¯ä½“éªŒæ›´å¥½
- å¯ä»¥è‡ªåŠ¨è·³è½¬åˆ°æ”¯ä»˜å® APP æˆ– H5 é¡µé¢

**æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èï¼‰

**å®ç°æ–¹å¼**ï¼š
```python
# åœ¨ alipay_client.py ä¸­æ·»åŠ 
def create_wap_trade(self, out_trade_no, subject, total_amount, 
                     return_url=None, notify_url=None):
    """åˆ›å»ºæ‰‹æœºç½‘ç«™æ”¯ä»˜è®¢å•"""
    # ä½¿ç”¨ alipay.trade.wap.pay æ¥å£
    # ä¸ç”µè„‘ç½‘ç«™æ”¯ä»˜ç±»ä¼¼ï¼Œåªæ˜¯ method ä¸åŒ
```

---

### âœ… 3. å•†å®¶è½¬è´¦ï¼ˆæ¨èç”¨äºå›æ”¶è®¢å•æ‰“æ¬¾ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å›æ”¶è®¢å•å®Œæˆåï¼Œå¹³å°æ‰“æ¬¾ç»™ç”¨æˆ·
- âœ… é€€æ¬¾åœºæ™¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

**å½“å‰çŠ¶æ€**ï¼šâš ï¸ éƒ¨åˆ†å®ç°ï¼ˆä»£ç ä¸­æœ‰æ³¨é‡Šï¼Œä½†æœªå®Œæ•´å®ç°ï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼š
- å›æ”¶è®¢å•å®Œæˆåéœ€è¦ç»™ç”¨æˆ·æ‰“æ¬¾
- è‡ªåŠ¨åŒ–æ‰“æ¬¾æµç¨‹ï¼Œæé«˜æ•ˆç‡
- å‡å°‘äººå·¥æ“ä½œ

**æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­ï¼ˆæ¨èï¼‰

**å®ç°æ–¹å¼**ï¼š
```python
# åœ¨ alipay_client.py ä¸­æ·»åŠ 
def transfer_to_account(self, out_biz_no, payee_account, amount, 
                        payee_real_name=None, remark=''):
    """å•ç¬”è½¬è´¦åˆ°æ”¯ä»˜å®è´¦æˆ·"""
    # ä½¿ç”¨ alipay.fund.trans.uni.transfer æ¥å£ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
    # æˆ– alipay.fund.trans.toaccount.transfer æ¥å£ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
```

**æ³¨æ„**ï¼š
- éœ€è¦ä¼ä¸šæ”¯ä»˜å®è´¦å·
- éœ€è¦å¼€é€šè½¬è´¦åŠŸèƒ½
- å¯èƒ½éœ€è¦é¢å¤–å®¡æ ¸

---

## äº§å“å¯¹æ¯”è¡¨

| äº§å“ | é€‚ç”¨åœºæ™¯ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ | æ¨èæŒ‡æ•° |
|------|---------|---------|--------|---------|
| **ç”µè„‘ç½‘ç«™æ”¯ä»˜** | PC ç«¯æ”¯ä»˜ | âœ… å·²å®ç° | é«˜ | â­â­â­â­â­ |
| **æ‰‹æœºç½‘ç«™æ”¯ä»˜** | ç§»åŠ¨ç«¯æ”¯ä»˜ | âŒ æœªå®ç° | é«˜ | â­â­â­â­â­ |
| **å•†å®¶è½¬è´¦** | å›æ”¶è®¢å•æ‰“æ¬¾ | âš ï¸ éƒ¨åˆ†å®ç° | ä¸­ | â­â­â­â­ |
| APPæ”¯ä»˜ | åŸç”Ÿ APP | âŒ ä¸é€‚ç”¨ | ä½ | - |
| å½“é¢ä»˜ | çº¿ä¸‹æ‰«ç  | âŒ ä¸é€‚ç”¨ | ä½ | - |
| JSAPIæ”¯ä»˜ | å°ç¨‹åº | âŒ ä¸é€‚ç”¨ | ä½ | - |

---

## è¯¦ç»†æ¨èè¯´æ˜

### 1. ç”µè„‘ç½‘ç«™æ”¯ä»˜ï¼ˆalipay.trade.page.payï¼‰

**å½“å‰å®ç°çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

**ä½¿ç”¨åœºæ™¯**ï¼š
- PC ç«¯ç”¨æˆ·è´­ä¹°æ˜“æ·˜å•†å“
- PC ç«¯ç”¨æˆ·è´­ä¹°å®˜æ–¹éªŒå•†å“

**æŠ€æœ¯å®ç°**ï¼š
- æ¥å£ï¼š`alipay.trade.page.pay`
- è¿”å›æ”¯ä»˜ URLï¼Œå‰ç«¯è·³è½¬
- æ”¯æŒå¼‚æ­¥é€šçŸ¥

**å»ºè®®**ï¼š
- âœ… ç»§ç»­ä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹
- âœ… ä¿æŒå½“å‰å®ç°

---

### 2. æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼ˆalipay.trade.wap.payï¼‰

**æ¨èç†ç”±**ï¼š
1. **ç§»åŠ¨ç«¯ç”¨æˆ·å¤š**ï¼šç°åœ¨å¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨æ‰‹æœºè®¿é—®
2. **ä½“éªŒæ›´å¥½**ï¼šç§»åŠ¨ç«¯ä½¿ç”¨æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼Œå¯ä»¥è‡ªåŠ¨è·³è½¬åˆ°æ”¯ä»˜å® APP
3. **ç»Ÿä¸€æ”¯ä»˜æµç¨‹**ï¼šä¸ç”µè„‘ç½‘ç«™æ”¯ä»˜ç±»ä¼¼ï¼Œæ˜“äºå®ç°

**å®ç°å»ºè®®**ï¼š

```python
# åœ¨ alipay_client.py ä¸­æ·»åŠ 
def create_wap_trade(self, out_trade_no, subject, total_amount, 
                     return_url=None, notify_url=None, quit_url=None):
    """
    åˆ›å»ºæ‰‹æœºç½‘ç«™æ”¯ä»˜è®¢å•
    æ¥å£ï¼šalipay.trade.wap.pay
    """
    biz_content = {
        'out_trade_no': str(out_trade_no),
        'product_code': 'QUICK_WAP_WAY',  # æ‰‹æœºç½‘ç«™æ”¯ä»˜äº§å“ç 
        'total_amount': f'{float(total_amount):.2f}',
        'subject': str(subject)[:256],
    }
    
    params = {
        'app_id': self.app_id,
        'method': 'alipay.trade.wap.pay',  # æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£
        'charset': self.charset,
        'sign_type': self.sign_type,
        'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        'version': self.version,
        'biz_content': json.dumps(biz_content, ensure_ascii=False, separators=(',', ':')),
    }
    
    if return_url:
        params['return_url'] = str(return_url)
    if notify_url:
        params['notify_url'] = str(notify_url)
    if quit_url:  # æ‰‹æœºç½‘ç«™æ”¯ä»˜ç‰¹æœ‰å‚æ•°
        params['quit_url'] = str(quit_url)
    
    params['sign'] = self._sign(params)
    
    # æ„å»ºæ”¯ä»˜URL
    sorted_params = sorted(params.items())
    query_parts = []
    for k, v in sorted_params:
        if v is not None:
            encoded_key = quote(str(k), safe='')
            encoded_value = quote(str(v), safe='')
            query_parts.append(f'{encoded_key}={encoded_value}')
    query_string = '&'.join(query_parts)
    payment_url = f'{self.gateway_url}?{query_string}'
    
    return {'success': True, 'payment_url': payment_url}
```

**å‰ç«¯åˆ¤æ–­**ï¼š
```javascript
// æ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©æ”¯ä»˜æ–¹å¼
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

if (isMobile) {
    // ä½¿ç”¨æ‰‹æœºç½‘ç«™æ”¯ä»˜
    result = await alipay.create_wap_trade(...)
} else {
    // ä½¿ç”¨ç”µè„‘ç½‘ç«™æ”¯ä»˜
    result = await alipay.create_trade(...)
}
```

**æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èå®ç°ï¼‰

---

### 3. å•†å®¶è½¬è´¦ï¼ˆalipay.fund.trans.uni.transferï¼‰

**æ¨èç†ç”±**ï¼š
1. **è‡ªåŠ¨åŒ–æ‰“æ¬¾**ï¼šå›æ”¶è®¢å•å®Œæˆåè‡ªåŠ¨æ‰“æ¬¾ç»™ç”¨æˆ·
2. **æé«˜æ•ˆç‡**ï¼šå‡å°‘äººå·¥æ“ä½œ
3. **èµ„é‡‘å®‰å…¨**ï¼šé€šè¿‡æ”¯ä»˜å®å®˜æ–¹æ¥å£ï¼Œå®‰å…¨å¯é 

**ä½¿ç”¨åœºæ™¯**ï¼š
- å›æ”¶è®¢å•å®Œæˆåæ‰“æ¬¾
- é€€æ¬¾åœºæ™¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

**å®ç°å»ºè®®**ï¼š

```python
# åœ¨ alipay_client.py ä¸­æ·»åŠ 
def transfer_to_account(self, out_biz_no, payee_account, amount, 
                        payee_real_name=None, remark=''):
    """
    å•ç¬”è½¬è´¦åˆ°æ”¯ä»˜å®è´¦æˆ·
    æ¥å£ï¼šalipay.fund.trans.uni.transferï¼ˆæ¨èï¼Œæ–°ç‰ˆæœ¬ï¼‰
    æˆ–ï¼šalipay.fund.trans.toaccount.transferï¼ˆæ—§ç‰ˆæœ¬ï¼‰
    """
    biz_content = {
        'out_biz_no': str(out_biz_no),  # å•†æˆ·è½¬è´¦å”¯ä¸€è®¢å•å·
        'trans_amount': f'{float(amount):.2f}',  # è½¬è´¦é‡‘é¢
        'product_code': 'TRANS_ACCOUNT_NO_PWD',  # äº§å“ç 
        'biz_scene': 'DIRECT_TRANSFER',  # ä¸šåŠ¡åœºæ™¯
        'payee_info': {
            'identity': str(payee_account),  # æ”¶æ¬¾æ–¹è´¦æˆ·
            'identity_type': 'ALIPAY_LOGON_ID',  # è´¦æˆ·ç±»å‹
        }
    }
    
    if payee_real_name:
        biz_content['payee_info']['name'] = str(payee_real_name)
    if remark:
        biz_content['remark'] = str(remark)[:200]
    
    params = {
        'app_id': self.app_id,
        'method': 'alipay.fund.trans.uni.transfer',
        'charset': self.charset,
        'sign_type': self.sign_type,
        'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        'version': self.version,
        'biz_content': json.dumps(biz_content, ensure_ascii=False, separators=(',', ':')),
    }
    
    params['sign'] = self._sign(params)
    
    try:
        response = requests.post(self.gateway_url, data=params, timeout=10)
        result = response.json()
        # å¤„ç†å“åº”...
    except Exception as e:
        # é”™è¯¯å¤„ç†...
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ éœ€è¦ä¼ä¸šæ”¯ä»˜å®è´¦å·
- âš ï¸ éœ€è¦å¼€é€šè½¬è´¦åŠŸèƒ½
- âš ï¸ å¯èƒ½éœ€è¦é¢å¤–å®¡æ ¸
- âš ï¸ æœ‰è½¬è´¦é™é¢å’Œæ‰‹ç»­è´¹ï¼ˆå…·ä½“æŸ¥çœ‹æ”¯ä»˜å®æ–‡æ¡£ï¼‰

**æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­ï¼ˆæ¨èï¼Œä½†éœ€è¦æ»¡è¶³æ¡ä»¶ï¼‰

---

## å®æ–½ä¼˜å…ˆçº§

### ç¬¬ä¸€é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰âœ…
- [x] ç”µè„‘ç½‘ç«™æ”¯ä»˜

### ç¬¬äºŒé˜¶æ®µï¼ˆæ¨èå®ç°ï¼‰ğŸ”¥
- [ ] æ‰‹æœºç½‘ç«™æ”¯ä»˜
  - **åŸå› **ï¼šç§»åŠ¨ç«¯ç”¨æˆ·å¤šï¼Œä½“éªŒæ›´å¥½
  - **éš¾åº¦**ï¼šä½ï¼ˆä¸ç”µè„‘ç½‘ç«™æ”¯ä»˜ç±»ä¼¼ï¼‰
  - **æ—¶é—´**ï¼š1-2 å¤©

### ç¬¬ä¸‰é˜¶æ®µï¼ˆå¯é€‰ï¼‰ğŸ’¡
- [ ] å•†å®¶è½¬è´¦
  - **åŸå› **ï¼šè‡ªåŠ¨åŒ–å›æ”¶è®¢å•æ‰“æ¬¾
  - **éš¾åº¦**ï¼šä¸­ï¼ˆéœ€è¦ä¼ä¸šè´¦å·å’Œå®¡æ ¸ï¼‰
  - **æ—¶é—´**ï¼š3-5 å¤©ï¼ˆå«å®¡æ ¸æ—¶é—´ï¼‰

---

## æ€»ç»“

### å¿…é¡»ä½¿ç”¨çš„äº§å“

1. **ç”µè„‘ç½‘ç«™æ”¯ä»˜** âœ… å·²å®ç°
   - ç”¨äº PC ç«¯æ”¯ä»˜
   - ç»§ç»­ä½¿ç”¨å½“å‰å®ç°

### å¼ºçƒˆæ¨èæ–°å¢

2. **æ‰‹æœºç½‘ç«™æ”¯ä»˜** â­â­â­â­â­
   - ç”¨äºç§»åŠ¨ç«¯æ”¯ä»˜
   - å®ç°ç®€å•ï¼Œä½“éªŒå¥½
   - **å»ºè®®ä¼˜å…ˆå®ç°**

### æ¨èæ–°å¢ï¼ˆéœ€æ»¡è¶³æ¡ä»¶ï¼‰

3. **å•†å®¶è½¬è´¦** â­â­â­â­
   - ç”¨äºå›æ”¶è®¢å•æ‰“æ¬¾
   - éœ€è¦ä¼ä¸šè´¦å·å’Œå®¡æ ¸
   - å¯ä»¥æå‡è‡ªåŠ¨åŒ–ç¨‹åº¦

### ä¸æ¨èçš„äº§å“

- **APPæ”¯ä»˜**ï¼šé¡¹ç›®æ˜¯ Web åº”ç”¨ï¼Œä¸æ˜¯åŸç”Ÿ APP
- **å½“é¢ä»˜**ï¼šé¡¹ç›®æ˜¯çº¿ä¸Šäº¤æ˜“ï¼Œä¸æ˜¯çº¿ä¸‹åœºæ™¯
- **JSAPIæ”¯ä»˜**ï¼šé¡¹ç›®ä¸æ˜¯å°ç¨‹åº

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**ï¼šç»§ç»­ä½¿ç”¨ç”µè„‘ç½‘ç«™æ”¯ä»˜ï¼ˆå·²å®ç°ï¼‰
2. **è¿‘æœŸ**ï¼šå®ç°æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼ˆå¼ºçƒˆæ¨èï¼‰
3. **åç»­**ï¼šæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œè€ƒè™‘å®ç°å•†å®¶è½¬è´¦

éœ€è¦æˆ‘å¸®æ‚¨å®ç°æ‰‹æœºç½‘ç«™æ”¯ä»˜åŠŸèƒ½å—ï¼Ÿ






