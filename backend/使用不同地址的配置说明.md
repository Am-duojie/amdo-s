# 确保前后端使用不同的 Ngrok 地址

## 已优化的配置

已修改 `ngrok.yml`，为前后端指定不同的区域：

```yaml
version: 3
agent:
  authtoken: 36TUDwWpJTqmuqX6TwUidfFZ8aL_3hNcLMa3t4T4dJgbrtcDq
tunnels:
  backend:
    addr: 8000
    proto: http
    region: us  # 美国区域
  frontend:
    addr: 5173
    proto: http
    region: jp  # 日本区域
```

## 启动方法

### 方法 1：使用启动脚本（推荐）

```powershell
cd D:\AAA\毕业设计\backend
.\启动ngrok所有隧道.ps1
```

### 方法 2：直接使用命令

```powershell
cd D:\AAA\毕业设计\backend
ngrok start --all --config ngrok.yml
```

## 启动后应该看到

```
Forwarding  https://xxxx-backend.ngrok-free.dev -> http://localhost:8000
Forwarding  https://yyyy-frontend.ngrok-free.dev -> http://localhost:5173
```

**重要**：两个地址必须不同！

## 配置步骤

### 1. 更新后端配置

启动后，复制后端地址，更新 `backend/core/settings.py`：

```python
FRONTEND_URL = 'https://yyyy-frontend.ngrok-free.dev'  # 前端地址
BACKEND_URL = 'https://xxxx-backend.ngrok-free.dev'    # 后端地址
```

### 2. 配置前端使用后端地址

在浏览器控制台运行（访问前端 ngrok 地址后）：

```javascript
localStorage.setItem('BACKEND_NGROK_URL', 'https://xxxx-backend.ngrok-free.dev')
location.reload()
```

或者创建 `frontend/.env` 文件：

```env
VITE_BACKEND_NGROK_URL=https://xxxx-backend.ngrok-free.dev
```

然后重启前端服务。

## 验证

1. **访问前端 ngrok 地址**：`https://yyyy-frontend.ngrok-free.dev`
2. **检查浏览器控制台**：应该能看到 API 请求发送到后端地址
3. **测试功能**：尝试加载商品列表、登录等，应该能正常工作

## 如果地址仍然相同

如果使用不同区域后地址仍然相同，可能是：

1. **ngrok 免费版限制**：免费版可能不支持多个独立隧道
2. **资源未释放**：需要等待更长时间（5-10 分钟）

可以尝试：
- 完全停止所有 ngrok 进程
- 等待 10 分钟
- 重新启动

或者使用**方案 3**（只使用后端 ngrok）。

## 区域说明

- `us`：美国区域（通常延迟较低）
- `jp`：日本区域（您当前使用的区域）
- `eu`：欧洲区域
- `ap`：亚太区域
- `au`：澳大利亚区域
- `sa`：南美区域
- `in`：印度区域

使用不同区域可以：
1. 确保获得不同的地址
2. 根据用户地理位置选择最优区域
3. 分散负载

## 注意事项

1. **延迟**：使用不同区域可能会增加延迟
2. **地址变化**：每次重启 ngrok，地址可能变化
3. **配置更新**：地址变化后需要更新 `settings.py` 和前端配置







