# 管理端「统计分析」一页说明（答辩/汇报）

## 1. 目标与范围
本模块为管理端 **数据看板/统计分析**，用于对三条业务线做统一的指标展示与快速筛选：
- 回收：`RecycleOrder`
- 官方验：`VerifiedOrder`（关联 `VerifiedProduct.brand/model`）
- 易淘（二手交易）：`Order`（关联 `Product.shop/category/title`）

实现方式：后端按时间/维度聚合 → 前端 BI 可视化（趋势、漏斗、TopN、表格导出）。

## 2. 指标定义（统计规则）
**时间口径**
- 按订单创建时间 `created_at` 统计（以数据库字段为准）。

**两类 GMV（金额口径）**
- **成交 GMV**：仅统计已付款/已完成订单金额之和（状态 `paid` / `completed`）。
- **下单 GMV**：统计所有下单订单金额之和；是否包含取消由开关控制（见下）。

**取消单的处理（两开关）**
- **订单数排除已取消（cancelled）**：只影响“订单数量/趋势/TopN 的计数口径”。
- **下单 GMV 包含已取消（cancelled）**：只影响“下单 GMV（金额）口径”。

> 说明：成交 GMV 不会受“是否包含取消”影响，因为成交 GMV 本身只统计 `paid/completed`。

## 3. 关键可视化与含义
**(1) 趋势图（按天）**
- 堆叠柱：回收/官方验/易淘的订单数（是否排除取消由开关决定）
- 折线：GMV（可切换成交/下单口径）

**(2) 订单状态漏斗（业务化）**
- 展示各状态数量（包含已取消），并在前端按状态顺序计算：
  - 转化率：本状态数量 / 上一状态数量
  - 流失：上一状态数量 − 本状态数量

**(3) 维度拆分 TopN（分组聚合）**
- 回收：品牌/机型 Top（按数量）
- 库存：品牌/机型 Top（按数量）
- 官方验订单：品牌/机型 GMV Top（按 GMV，可切换成交/下单）
- 易淘订单：分类/店铺/商品 GMV Top（按 GMV，可切换成交/下单）

## 4. 数据链路（实现映射）
**后端聚合接口**
- 统计 API：`backend/app/admin_api/views.py` -> `StatisticsView`（路由：`/admin-api/statistics`）
- 聚合手段：Django ORM `Count/Sum` + `TruncDate(created_at)` 分组，返回：
  - `trend`：按天数组（订单数 + 成交/下单 GMV）
  - `funnels`：各状态数量（用于漏斗与转化/流失）
  - `breakdown`：TopN 维度拆分（数量/GMV）

**前端可视化**
- 页面：`frontend/src/admin/pages/Statistics.vue`
- 路由入口：`/admin/statistics`（`frontend/src/router/index.js`）
- 图表：ECharts（趋势图/漏斗/TopN 条形图）
- 表格：按天明细 + CSV 导出（包含成交GMV与下单GMV）

## 5. 与「数据科学与大数据技术」专业相关性（答辩要点）
**数据分析/BI 能力（已实现）**
- 指标体系：订单数、GMV（成交/下单）、状态漏斗转化/流失、TopN 维度拆分
- 口径一致性：将“计数口径”和“金额口径”拆开开关，并在页面说明规则，避免口径混淆
- OLAP 思维：时间（天）+ 维度（品牌/机型/分类/店铺）聚合分析

**可扩展到大数据技术栈（答辩扩展设计）**
- 数据量增大后，可将当前“在线聚合”演进为：
  - ODS（明细订单）→ DWD（宽表）→ DWS（按天/维度汇总）→ ADS（看板指标）
  - 批处理：Spark/Hive（离线 T+1 或小时级）
  - 实时：Flink（分钟级）+ ClickHouse/ES（查询加速）
- 看板层只读取汇总表/指标表，稳定、快、口径统一。

## 6. 验证方式（最小）
1. 管理端登录后访问：`/admin/statistics`
2. 切换“成交GMV/下单GMV”、两开关与状态过滤，观察趋势/TopN/表格同步变化
3. 导出 CSV，确认包含成交GMV与下单GMV两列

