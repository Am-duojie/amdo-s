# 智能估价算法说明

## 算法概述

本系统实现了一个智能的二手设备估价算法，综合考虑多个因素来估算设备回收价格。

## 算法公式

```
最终价格 = 基础价格 × 存储系数 × 品牌系数 × 成色系数 × 时间衰减系数
```

## 影响因素

### 1. 基础价格

基础价格基于设备型号和存储容量（以128GB为基准）：
- 从价格数据库中查找对应型号的128GB版本价格
- 如果没有128GB，则从其他存储版本反向计算

### 2. 存储容量系数

不同存储容量的价格差异：

| 存储容量 | 系数 | 说明 |
|---------|------|------|
| 64GB | 0.85 | 相对128GB便宜15% |
| 128GB | 1.0 | 基准价格 |
| 256GB | 1.15 | 相对128GB贵15% |
| 512GB | 1.35 | 相对128GB贵35% |
| 1TB | 1.60 | 相对128GB贵60% |
| 2TB | 2.0 | 相对128GB贵100% |

### 3. 品牌保值率

不同品牌的保值率（以苹果为基准100%）：

| 品牌 | 保值率 | 说明 |
|------|--------|------|
| 苹果 | 100% | 基准，保值率最高 |
| 华为 | 85% | 高端机型保值较好 |
| 三星 | 80% | 国际品牌，保值较好 |
| 小米 | 75% | 性价比品牌 |
| 荣耀 | 75% | 性价比品牌 |
| 一加 | 75% | 性价比品牌 |
| OPPO | 70% | 中端品牌 |
| vivo | 70% | 中端品牌 |
| realme | 65% | 入门品牌 |
| 红米 | 65% | 入门品牌 |

### 4. 成色系数

设备成色对价格的影响：

| 成色 | 系数 | 说明 |
|------|------|------|
| 全新（new） | 1.0 | 未使用，原价 |
| 几乎全新（like_new） | 0.85 | 使用时间短，外观完美 |
| 良好（good） | 0.70 | 正常使用痕迹，功能完好 |
| 一般（fair） | 0.50 | 有明显使用痕迹 |
| 较差（poor） | 0.30 | 外观磨损严重 |

### 5. 时间衰减系数

根据设备发布年份计算时间衰减（可选）：

| 使用年限 | 系数 | 说明 |
|---------|------|------|
| 0年（当年） | 1.0 | 无衰减 |
| 1年 | 0.85 | 轻微衰减 |
| 2年 | 0.70 | 中等衰减 |
| 3年 | 0.55 | 较大衰减 |
| 4年 | 0.40 | 大幅衰减 |
| 5年+ | 0.25+ | 持续衰减 |

## 计算示例

### 示例1：iPhone 15 Pro Max 256GB，成色良好

```
基础价格（128GB） = 6500元
存储系数（256GB） = 1.15
品牌系数（苹果） = 1.0
成色系数（良好） = 0.70

最终价格 = 6500 × 1.15 × 1.0 × 0.70 = 5,232.5元
```

### 示例2：华为Mate 60 Pro 512GB，成色良好

```
基础价格（256GB） = 4500元
存储系数（512GB） = 1.35
品牌系数（华为） = 0.85
成色系数（良好） = 0.70

最终价格 = 4500 × 1.35 × 0.85 × 0.70 = 3,614.6元
```

## 支持的主流手机

### 苹果（iPhone）
- iPhone 15系列：15 Pro Max, 15 Pro, 15 Plus, 15
- iPhone 14系列：14 Pro Max, 14 Pro, 14 Plus, 14
- iPhone 13系列：13 Pro Max, 13 Pro, 13, 13 mini
- iPhone 12系列：12 Pro Max, 12 Pro, 12, 12 mini
- iPhone 11系列：11 Pro Max, 11 Pro, 11

### 华为
- Mate系列：Mate 60 Pro+, Mate 60 Pro, Mate 60, Mate 50 Pro, Mate 50
- P系列：P60 Art, P60 Pro, P60, P50 Pro, P50
- nova系列：nova 12, nova 11

### 小米
- 数字系列：14 Ultra, 14 Pro, 14, 13 Ultra, 13 Pro, 13
- 12系列：12S Ultra, 12 Pro, 12

### vivo
- X系列：X100 Pro, X100, X90 Pro+, X90 Pro, X90
- S系列：S18 Pro, S17 Pro

### OPPO
- Find X系列：X7 Ultra, X6 Pro, X6, X5 Pro
- Reno系列：Reno11 Pro, Reno10 Pro

### 荣耀
- Magic系列：Magic6 Pro, Magic5 Pro, Magic4 Pro
- 数字系列：100 Pro, 90 Pro

### 三星
- Galaxy S系列：S24 Ultra, S24+, S24, S23 Ultra, S23+, S23
- Note系列：Note20 Ultra

### 其他品牌
- 一加：OnePlus 12, OnePlus 11, OnePlus Ace 3
- realme：GT5 Pro, GT Neo6
- 红米：Redmi K70 Pro, Redmi K70, Redmi Note 13 Pro

## 价格数据更新

### 手动更新

使用管理命令更新价格数据：

```bash
# 导出当前价格数据
python manage.py update_price_database --export prices.json

# 编辑 prices.json 文件

# 导入更新后的价格数据
python manage.py update_price_database --file prices.json

# 列出所有支持的型号
python manage.py update_price_database --list
```

### 价格数据格式

```json
{
  "苹果": {
    "iPhone 15 Pro Max": {
      "128GB": 6500,
      "256GB": 7200,
      "512GB": 8500,
      "1TB": 10000
    }
  }
}
```

## API使用示例

### 请求示例

```http
POST /api/recycle-orders/estimate/
Content-Type: application/json

{
  "device_type": "手机",
  "brand": "苹果",
  "model": "iPhone 15 Pro Max",
  "storage": "256GB",
  "condition": "good",
  "release_year": 2023  // 可选
}
```

### 响应示例

```json
{
  "estimated_price": 5232.5,
  "bonus": 150.0,
  "total_price": 5382.5,
  "source": "model",
  "currency": "CNY",
  "unit": "元"
}
```

## 算法优势

1. **准确性**：基于市场实际价格数据
2. **灵活性**：支持多种因素组合
3. **可扩展**：易于添加新品牌和型号
4. **透明性**：计算过程清晰可追溯
5. **实时性**：支持定期更新价格数据

## 注意事项

1. **价格数据时效性**：市场价格会波动，建议定期更新
2. **地区差异**：不同地区价格可能有差异
3. **特殊版本**：限量版、定制版等可能需要特殊处理
4. **配件影响**：原装配件、包装等可能影响价格
5. **市场行情**：重大事件（如新品发布）会影响价格

## 未来改进方向

1. **机器学习**：使用历史交易数据训练价格预测模型
2. **实时更新**：接入实时价格API自动更新
3. **地区差异**：支持不同地区的价格差异
4. **配件评估**：考虑配件对价格的影响
5. **市场趋势**：考虑市场趋势和季节性因素

